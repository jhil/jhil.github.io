!function(e){"use strict";function i(){var e,i=document.createElement("fakeelement"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"};for(e in t)if(t.hasOwnProperty(e)&&void 0!==i.style[e])return t[e]}function t(e){return this.viewerOpen=!1,this.figure=e,this.lastWindowWidth=window.innerWidth,this.transitionEndEvent=i(),this.forceSmall=this.figure.className.indexOf("force-small")>=0,this.forceMedium=this.figure.className.indexOf("force-medium")>=0,this.forceLarge=this.figure.className.indexOf("force-large")>=0,this.load(),this.figure.className.indexOf("with-viewer")>=0&&this.figure.addEventListener("click",this.openViewer.bind(this)),this}t.prototype.closeViewer=function(){window.removeEventListener("scroll",this.onScroll),this.figure.addEventListener(this.transitionEndEvent,function(){document.body.className.indexOf("viewer-open")==-1&&(this.viewerOpen=!1,this.figure.className=this.figure.className.replace("viewer-open","").replace(/^\s+|\s+$/g,""),this.figure.style.zIndex="")}.bind(this)),document.body.className=document.body.className.replace("viewer-open","").replace(/^\s+|\s+$/g,""),this.figure.style.transform=""},t.prototype.openViewer=function(){if(document.body.className.indexOf("viewer-open")>=0)return void this.closeViewer();this.viewerOpen=!0;var e,i,t,n=window.getComputedStyle(this.figure),s=parseFloat(n.height),r=parseFloat(n.width),o=window.innerHeight,a=window.innerWidth,d=this.figure.getBoundingClientRect(),l=r/s,h=a/o;if(h>=l){e=o/s;var f=r*e;i=(a-f)/2-d.left,t=d.top*-1}else{e=a/r;var c=s*e;t=(o-c)/2-d.top,i=d.left*-1}document.body.className+=" viewer-open",this.figure.className+=" viewer-open",this.figure.style.zIndex="800",this.figure.style.transform="translate3d("+i+"px,"+t+"px,0) scale("+e+")",setTimeout(function(){this.figure.className.indexOf("loaded-raw")<=0&&this.loadRaw()}.bind(this),300),this.onScroll=function(){var e=this.figure.getBoundingClientRect().top;Math.abs(e)>50&&this.closeViewer()}.bind(this),this.onResize=function(){this.closeViewer()}.bind(this),window.addEventListener("resize",this.onResize),window.addEventListener("orientationchange",this.onResize),window.addEventListener("scroll",this.onScroll)},t.prototype.load=function(){var e=new Image;e.src=this.figure.dataset[this.getSize()],e.className="full",e.onload=function(){this.figure.className+=" loaded"}.bind(this),this.figure.appendChild(e)},t.prototype.loadRaw=function(){var e=new Image;e.src=this.figure.dataset.raw,e.className="raw",e.onload=function(){this.figure.className+=" loaded-raw"}.bind(this),this.figure.appendChild(e)},t.prototype.getSize=function(){if(this.forceSmall)return"small";if(this.forceMedium)return"medium";if(this.forceLarge)return"large";var e,i=["small","medium","large"];return e=this.lastWindowWidth<768?0:this.lastWindowWidth<1440?1:2,window.devicePixelRatio>1&&e<2&&(e+=1),i[e]},"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t:e.ProgressiveImage=t}(this);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2dyZXNzaXZlLWltYWdlLmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsIl93aGljaFRyYW5zaXRpb25FbmRFdmVudCIsInQiLCJlbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRyYW5zaXRpb25zIiwiV2Via2l0VHJhbnNpdGlvbiIsIk1velRyYW5zaXRpb24iLCJNU1RyYW5zaXRpb24iLCJPVHJhbnNpdGlvbiIsInRyYW5zaXRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsInVuZGVmaW5lZCIsInN0eWxlIiwiUHJvZ3Jlc3NpdmVJbWFnZSIsImZpZ3VyZSIsInRoaXMiLCJ2aWV3ZXJPcGVuIiwibGFzdFdpbmRvd1dpZHRoIiwid2luZG93IiwiaW5uZXJXaWR0aCIsInRyYW5zaXRpb25FbmRFdmVudCIsImZvcmNlU21hbGwiLCJjbGFzc05hbWUiLCJpbmRleE9mIiwiZm9yY2VNZWRpdW0iLCJmb3JjZUxhcmdlIiwibG9hZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvcGVuVmlld2VyIiwiYmluZCIsInByb3RvdHlwZSIsImNsb3NlVmlld2VyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm9uU2Nyb2xsIiwiYm9keSIsInJlcGxhY2UiLCJ6SW5kZXgiLCJ0cmFuc2Zvcm0iLCJzY2FsZSIsInRyYW5zbGF0ZVgiLCJ0cmFuc2xhdGVZIiwiZmlndXJlU3R5bGUiLCJnZXRDb21wdXRlZFN0eWxlIiwiaW5pdGlhbEhlaWdodCIsInBhcnNlRmxvYXQiLCJoZWlnaHQiLCJpbml0aWFsV2lkdGgiLCJ3aWR0aCIsIndpbmRvd0hlaWdodCIsImlubmVySGVpZ2h0Iiwid2luZG93V2lkdGgiLCJmaWd1cmVCb3VuZGluZ1JlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJmaWd1cmVBc3BlY3RSYXRpbyIsIndpbmRvd0FzcGVjdFJhdGlvIiwiZmluYWxXaWR0aCIsImxlZnQiLCJ0b3AiLCJmaW5hbEhlaWdodCIsInNldFRpbWVvdXQiLCJsb2FkUmF3Iiwib2Zmc2V0IiwiTWF0aCIsImFicyIsIm9uUmVzaXplIiwiZnVsbEltYWdlIiwiSW1hZ2UiLCJzcmMiLCJkYXRhc2V0IiwiZ2V0U2l6ZSIsIm9ubG9hZCIsImFwcGVuZENoaWxkIiwicmF3SW1hZ2UiLCJyYXciLCJzaXplSW5kZXgiLCJzaXplcyIsImRldmljZVBpeGVsUmF0aW8iLCJkZWZpbmUiLCJhbWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQ0FBQyxTQUFVQSxHQUNULFlBT0EsU0FBU0MsS0FDUCxHQUFJQyxHQUNBQyxFQUFLQyxTQUFTQyxjQUFjLGVBQzVCQyxHQUNGQyxpQkFBa0Isc0JBQ2xCQyxjQUFlLGdCQUNmQyxhQUFjLGtCQUNkQyxZQUFhLGlCQUNiQyxXQUFZLGdCQUVkLEtBQUtULElBQUtJLEdBQ1IsR0FBSUEsRUFBWU0sZUFBZVYsSUFDVFcsU0FBaEJWLEVBQUdXLE1BQU1aLEdBQ1gsTUFBT0ksR0FBWUosR0F1QjNCLFFBQVNhLEdBQWlCQyxHQWN4QixNQWJBQyxNQUFLQyxZQUFhLEVBQ2xCRCxLQUFLRCxPQUFTQSxFQUNkQyxLQUFLRSxnQkFBa0JDLE9BQU9DLFdBQzlCSixLQUFLSyxtQkFBcUJyQixJQUMxQmdCLEtBQUtNLFdBQWNOLEtBQUtELE9BQU9RLFVBQVVDLFFBQVEsZ0JBQWtCLEVBQ25FUixLQUFLUyxZQUFlVCxLQUFLRCxPQUFPUSxVQUFVQyxRQUFRLGlCQUFtQixFQUNyRVIsS0FBS1UsV0FBY1YsS0FBS0QsT0FBT1EsVUFBVUMsUUFBUSxnQkFBa0IsRUFDbkVSLEtBQUtXLE9BRURYLEtBQUtELE9BQU9RLFVBQVVDLFFBQVEsZ0JBQWtCLEdBQ2xEUixLQUFLRCxPQUFPYSxpQkFBaUIsUUFBU1osS0FBS2EsV0FBV0MsS0FBS2QsT0FHdERBLEtBR1RGLEVBQWlCaUIsVUFBVUMsWUFBYyxXQUN2Q2IsT0FBT2Msb0JBQW9CLFNBQVVqQixLQUFLa0IsVUFDMUNsQixLQUFLRCxPQUFPYSxpQkFBaUJaLEtBQUtLLG1CQUFvQixXQUNoRGxCLFNBQVNnQyxLQUFLWixVQUFVQyxR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SUFDSWlELEdBREFDLEdBQVMsUUFBUyxTQUFVLFFBZWhDLE9BWkVELEdBREUzRCxLQUFLRSxnQkFBa0IsSUFDYixFQUNIRixLQUFLRSxnQkFBa0IsS0FDcEIsRUFFQSxFQUlWQyxPQUFPMEQsaUJBQW1CLEdBQUtGLEVBQVksSUFDN0NBLEdBQWEsR0FHUkMsRUFBTUQsSUFJTyxrQkFBWEcsU0FBeUJBLE9BQU9DLElBQ3pDRCxPQUFPaEUsR0FDb0IsbUJBQVhrRSxTQUEwQkEsT0FBT0MsUUFDakRELE9BQU9DLFFBQVVuRSxFQUVqQmYsRUFBT2UsaUJBQW1CQSxHQUc1QkUiLCJmaWxlIjoicHJvZ3Jlc3NpdmUtaW1hZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKGdsb2JhbCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgLyoqXG4gICAqIEZpbmQgdGhlIENTUyB0cmFuc2l0aW9uIGVuZCBldmVudCB0aGF0IHdlIHNob3VsZCBsaXN0ZW4gZm9yLlxuICAgKlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSB0IC0gdGhlIHRyYW5zaXRpb24gc3RyaW5nXG4gICAqL1xuICBmdW5jdGlvbiBfd2hpY2hUcmFuc2l0aW9uRW5kRXZlbnQoKSB7XG4gICAgdmFyIHQ7XG4gICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmFrZWVsZW1lbnQnKTtcbiAgICB2YXIgdHJhbnNpdGlvbnMgPSB7XG4gICAgICBXZWJraXRUcmFuc2l0aW9uOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcsXG4gICAgICBNb3pUcmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgICBNU1RyYW5zaXRpb246ICdtc1RyYW5zaXRpb25FbmQnLFxuICAgICAgT1RyYW5zaXRpb246ICdvdHJhbnNpdGlvbmVuZCcsXG4gICAgICB0cmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgfTtcbiAgICBmb3IgKHQgaW4gdHJhbnNpdGlvbnMpIHtcbiAgICAgIGlmICh0cmFuc2l0aW9ucy5oYXNPd25Qcm9wZXJ0eSh0KSkge1xuICAgICAgICBpZiAoZWwuc3R5bGVbdF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJldHVybiB0cmFuc2l0aW9uc1t0XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGNsYXNzIG1hbmFnZXMgYSBzaW5nbGUgaW1hZ2UuIEl0IGtlZXBzIHRyYWNrIG9mIHRoZSBpbWFnZSdzIGhlaWdodCxcbiAgICogd2lkdGgsIGFuZCBwb3NpdGlvbiBpbiB0aGUgZ3JpZC4gQW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcyBpcyBhc3NvY2lhdGVkXG4gICAqIHdpdGggYSBzaW5nbGUgaW1hZ2UgZmlndXJlLCB3aGljaCBsb29rcyBsaWtlIHRoaXM6XG4gICAqXG4gICAqICAgPGZpZ3VyZSBjbGFzcz1cInByb2dyZXNzaXZlLWltYWdlXCJcbiAgICogICAgICAgZGF0YS1zbWFsbD1cIi4uLlwiXG4gICAqICAgICAgIGRhdGEtbWVkaXVtPVwiLi4uXCJcbiAgICogICAgICAgZGF0YS1sYXJnZT1cIi4uLlwiXG4gICAqICAgICAgIGRhdGEtcmF3PVwiLi4uXCI+XG4gICAqICAgICA8ZGl2IGNsYXNzPVwiYXNwZWN0LXJhdGlvLWhvbGRlclwiIHN0eWxlPVwicGFkZGluZy1ib3R0b206IC4uLlwiPjwvZGl2PlxuICAgKiAgICAgPGltZyBjbGFzcz1cInRodW1ibmFpbFwiIHNyYz1cIi4uLlwiIGFsdD1cIi4uLlwiPlxuICAgKiAgIDwvZmlndXJlPlxuICAgKlxuICAgKiBAcGFyYW0ge2VsZW1lbnR9IGZpZ3VyZSAtIHRoZSA8ZmlndXJlPiBET00gZWxlbWVudC5cbiAgICogQHJldHVybnMge29iamVjdH0gdGhlIHByb2dyZXNzaXZlIGltYWdlIG9iamVjdFxuICAgKi9cbiAgZnVuY3Rpb24gUHJvZ3Jlc3NpdmVJbWFnZShmaWd1cmUpIHtcbiAgICB0aGlzLnZpZXdlck9wZW4gPSBmYWxzZTtcbiAgICB0aGlzLmZpZ3VyZSA9IGZpZ3VyZTtcbiAgICB0aGlzLmxhc3RXaW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIHRoaXMudHJhbnNpdGlvbkVuZEV2ZW50ID0gX3doaWNoVHJhbnNpdGlvbkVuZEV2ZW50KCk7XG4gICAgdGhpcy5mb3JjZVNtYWxsID0gKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdmb3JjZS1zbWFsbCcpID49IDApO1xuICAgIHRoaXMuZm9yY2VNZWRpdW0gPSAodGhpcy5maWd1cmUuY2xhc3NOYW1lLmluZGV4T2YoJ2ZvcmNlLW1lZGl1bScpID49IDApO1xuICAgIHRoaXMuZm9yY2VMYXJnZSA9ICh0aGlzLmZpZ3VyZS5jbGFzc05hbWUuaW5kZXhPZignZm9yY2UtbGFyZ2UnKSA+PSAwKTtcbiAgICB0aGlzLmxvYWQoKTtcblxuICAgIGlmICh0aGlzLmZpZ3VyZS5jbGFzc05hbWUuaW5kZXhPZignd2l0aC12aWV3ZXInKSA+PSAwKSB7XG4gICAgICB0aGlzLmZpZ3VyZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub3BlblZpZXdlci5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIFByb2dyZXNzaXZlSW1hZ2UucHJvdG90eXBlLmNsb3NlVmlld2VyID0gZnVuY3Rpb24gKCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcbiAgICB0aGlzLmZpZ3VyZS5hZGRFdmVudExpc3RlbmVyKHRoaXMudHJhbnNpdGlvbkVuZEV2ZW50LCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoZG9jdW1lbnQuYm9keS5jbGFzc05hbWUuaW5kZXhPZigndmlld2VyLW9wZW4nKSA9PSAtMSkge1xuICAgICAgICB0aGlzLnZpZXdlck9wZW4gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5maWd1cmUuY2xhc3NOYW1lID0gdGhpcy5maWd1cmUuY2xhc3NOYW1lXG4gICAgICAgICAgLnJlcGxhY2UoJ3ZpZXdlci1vcGVuJywgJycpXG4gICAgICAgICAgLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTtcbiAgICAgICAgdGhpcy5maWd1cmUuc3R5bGUuekluZGV4ID0gJyc7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIC8vIEJlZ2luIHRyYW5zaXRpb25cbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSA9IGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lXG4gICAgICAucmVwbGFjZSgndmlld2VyLW9wZW4nLCAnJylcbiAgICAgIC5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gICAgdGhpcy5maWd1cmUuc3R5bGUudHJhbnNmb3JtID0gJyc7XG4gIH07XG5cbiAgUHJvZ3Jlc3NpdmVJbWFnZS5wcm90b3R5cGUub3BlblZpZXdlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQuYm9keS5jbGFzc05hbWUuaW5kZXhPZigndmlld2VyLW9wZW4nKSA+PSAwKSB7XG4gICAgICB0aGlzLmNsb3NlVmlld2VyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy52aWV3ZXJPcGVuID0gdHJ1ZTtcblxuICAgIC8vIEluaXRpYWwgVmFsdWVzXG4gICAgdmFyIGZpZ3VyZVN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5maWd1cmUpO1xuICAgIHZhciBpbml0aWFsSGVpZ2h0ID0gcGFyc2VGbG9hdChmaWd1cmVTdHlsZS5oZWlnaHQpO1xuICAgIHZhciBpbml0aWFsV2lkdGggPSBwYXJzZUZsb2F0KGZpZ3VyZVN0eWxlLndpZHRoKTtcbiAgICB2YXIgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgIHZhciB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIHZhciBmaWd1cmVCb3VuZGluZ1JlY3QgPSB0aGlzLmZpZ3VyZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIC8vIENvbXB1dGVkIFZhbHVlc1xuICAgIHZhciBmaWd1cmVBc3BlY3RSYXRpbyA9IGluaXRpYWxXaWR0aCAvIGluaXRpYWxIZWlnaHQ7XG4gICAgdmFyIHdpbmRvd0FzcGVjdFJhdGlvID0gd2luZG93V2lkdGggLyB3aW5kb3dIZWlnaHQ7XG4gICAgdmFyIHNjYWxlO1xuICAgIHZhciB0cmFuc2xhdGVYO1xuICAgIHZhciB0cmFuc2xhdGVZO1xuXG4gICAgaWYgKHdpbmRvd0FzcGVjdFJhdGlvID49IGZpZ3VyZUFzcGVjdFJhdGlvKSB7XG4gICAgICAvLyBJbWFnZSB3aWxsIGZpbGwgdXAgdmVydGljYWwgc3BhY2VcbiAgICAgIHNjYWxlID0gd2luZG93SGVpZ2h0IC8gaW5pdGlhbEhlaWdodDtcbiAgICAgIHZhciBmaW5hbFdpZHRoID0gaW5pdGlhbFdpZHRoICogc2NhbGU7XG4gICAgICB0cmFuc2xhdGVYID0gKHdpbmRvd1dpZHRoIC0gZmluYWxXaWR0aCkgLyAyIC0gZmlndXJlQm91bmRpbmdSZWN0LmxlZnQ7XG4gICAgICB0cmFuc2xhdGVZID0gZmlndXJlQm91bmRpbmdSZWN0LnRvcCAqIC0xO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEltYWdlIHdpbGwgZmlsbCB1cCBob3Jpem9udGFsIHNwYWNlXG4gICAgICBzY2FsZSA9IHdpbmRvd1dpZHRoIC8gaW5pdGlhbFdpZHRoO1xuICAgICAgdmFyIGZpbmFsSGVpZ2h0ID0gaW5pdGlhbEhlaWdodCAqIHNjYWxlO1xuICAgICAgdHJhbnNsYXRlWSA9ICh3aW5kb3dIZWlnaHQgLSBmaW5hbEhlaWdodCkgLyAyIC0gZmlndXJlQm91bmRpbmdSZWN0LnRvcDtcbiAgICAgIHRyYW5zbGF0ZVggPSBmaWd1cmVCb3VuZGluZ1JlY3QubGVmdCAqIC0xO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IERPTSB0cmFuc2Zvcm1hdGlvbnNcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSArPSAnIHZpZXdlci1vcGVuJztcbiAgICB0aGlzLmZpZ3VyZS5jbGFzc05hbWUgKz0gJyB2aWV3ZXItb3Blbic7XG4gICAgdGhpcy5maWd1cmUuc3R5bGUuekluZGV4ID0gJzgwMCc7XG4gICAgdGhpcy5maWd1cmUuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKCcgKyB0cmFuc2xhdGVYICsgJ3B4LCcgK1xuICAgICAgdHJhbnNsYXRlWSArICdweCwwKSBzY2FsZSgnICsgc2NhbGUgKyAnKSc7XG5cbiAgICAvLyBMb2FkIFJhdyBJbWFnZSAobGFyZ2UhKVxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdsb2FkZWQtcmF3JykgPD0gMCkge1xuICAgICAgICAvLyBUaGVyZSBpcyBhIGxhcmdlciBpbWFnZSB0byBsb2FkLlxuICAgICAgICB0aGlzLmxvYWRSYXcoKTtcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcyksIDMwMCk7XG5cbiAgICB0aGlzLm9uU2Nyb2xsID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG9mZnNldCA9IHRoaXMuZmlndXJlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcbiAgICAgIGlmIChNYXRoLmFicyhvZmZzZXQpID4gNTApIHtcbiAgICAgICAgdGhpcy5jbG9zZVZpZXdlcigpO1xuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKTtcblxuICAgIHRoaXMub25SZXNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNsb3NlVmlld2VyKCk7XG4gICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25SZXNpemUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMub25SZXNpemUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcbiAgfTtcblxuICAvKipcbiAgICogTG9hZCB0aGUgZnVsbCBpbWFnZSBlbGVtZW50IGludG8gdGhlIERPTS5cbiAgICovXG4gIFByb2dyZXNzaXZlSW1hZ2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gQ3JlYXRlIGEgbmV3IGltYWdlIGVsZW1lbnQsIGFuZCBpbnNlcnQgaXQgaW50byB0aGUgRE9NLlxuICAgIHZhciBmdWxsSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICBmdWxsSW1hZ2Uuc3JjID0gdGhpcy5maWd1cmUuZGF0YXNldFt0aGlzLmdldFNpemUoKV07XG4gICAgZnVsbEltYWdlLmNsYXNzTmFtZSA9ICdmdWxsJztcbiAgICBmdWxsSW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5maWd1cmUuY2xhc3NOYW1lICs9ICcgbG9hZGVkJztcbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmZpZ3VyZS5hcHBlbmRDaGlsZChmdWxsSW1hZ2UpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBMb2FkIHRoZSByYXcgaW1hZ2UgZWxlbWVudCBpbnRvIHRoZSBET00uXG4gICAqL1xuICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5sb2FkUmF3ID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIENyZWF0ZSBhIG5ldyBpbWFnZSBlbGVtZW50LCBhbmQgaW5zZXJ0IGl0IGludG8gdGhlIERPTS5cbiAgICB2YXIgcmF3SW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICAgIC8vIG5vdCBhY3R1YWxseSByYXcsIGJlY2F1c2UgZGFtbiwgdGhhdCdzIGV4cGVuc2l2ZS5cbiAgICByYXdJbWFnZS5zcmMgPSB0aGlzLmZpZ3VyZS5kYXRhc2V0LnJhdztcbiAgICByYXdJbWFnZS5jbGFzc05hbWUgPSAncmF3JztcbiAgICByYXdJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmZpZ3VyZS5jbGFzc05hbWUgKz0gJyBsb2FkZWQtcmF3JztcbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmZpZ3VyZS5hcHBlbmRDaGlsZChyYXdJbWFnZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENob29zZSB0aGUgc2l6ZSBvZiBpbWFnZSB0byBsb2FkIGJhc2VkIG9uIHRoZSB3aW5kb3cgd2lkdGguXG4gICAqL1xuICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5nZXRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmZvcmNlU21hbGwpIHtcbiAgICAgIHJldHVybiAnc21hbGwnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5mb3JjZU1lZGl1bSkge1xuICAgICAgcmV0dXJuICdtZWRpdW0nO1xuICAgIH0gZWxzZSBpZiAodGhpcy5mb3JjZUxhcmdlKSB7XG4gICAgICByZXR1cm4gJ2xhcmdlJztcbiAgICB9XG5cbiAgICB2YXIgc2l6ZXMgPSBbJ3NtYWxsJywgJ21lZGl1bScsICdsYXJnZSddO1xuICAgIHZhciBzaXplSW5kZXg7XG4gICAgaWYgKHRoaXMubGFzdFdpbmRvd1dpZHRoIDwgNzY4KSB7XG4gICAgICBzaXplSW5kZXggPSAwOyAvLyBzbWFsbFxuICAgIH0gZWxzZSBpZiAodGhpcy5sYXN0V2luZG93V2lkdGggPCAxNDQwKSB7XG4gICAgICBzaXplSW5kZXggPSAxOyAvLyBtZWRpdW1cbiAgICB9IGVsc2Uge1xuICAgICAgc2l6ZUluZGV4ID0gMjsgLy8gbGFyZ2U7XG4gICAgfVxuXG4gICAgLy8gUmV0aW5hIGRldmljZXMgc2hvdWxkIGhhdmUgbGFyZ2VyIHBpeGVsIGRlbnNpdGllcy5cbiAgICBpZiAod2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxICYmIHNpemVJbmRleCA8IDIpIHtcbiAgICAgIHNpemVJbmRleCArPSAxO1xuICAgIH1cblxuICAgIHJldHVybiBzaXplc1tzaXplSW5kZXhdO1xuICB9O1xuXG4gIC8vIEV4cG9ydCBQcm9ncmVzc2l2ZUltYWdlIGludG8gdGhlIGdsb2JhbCBzY29wZS5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShQcm9ncmVzc2l2ZUltYWdlKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gUHJvZ3Jlc3NpdmVJbWFnZTtcbiAgfSBlbHNlIHtcbiAgICBnbG9iYWwuUHJvZ3Jlc3NpdmVJbWFnZSA9IFByb2dyZXNzaXZlSW1hZ2U7XG4gIH1cblxufSh0aGlzKSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=